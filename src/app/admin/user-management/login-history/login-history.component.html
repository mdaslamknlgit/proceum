<div class="mn_dshbrd">
  <div class="brd_crm">
    {{"proceum_text"|translate}} &raquo; {{"admin.side_menu.user_management"|translate}} &raquo; <strong>{{"admin.side_menu.login_history"|translate}}</strong>
  </div>
  <div class="pg_ttl">{{"admin.side_menu.login_history"|translate}}</div>

  <div class="dsh_brd_crds inputs_wdth_200">
    <div>
      <div class="cm_fltr_sc mr_1" *ngIf="role_id != 12">
        <span>{{"admin.mng_usr.role"|translate}}</span>
        <mat-form-field appearance="outline">
            <mat-select placeholder="{{'select_text'|translate}} {{'admin.mng_usr.role'|translate}}" name="role_edit" #role_edit="ngModel" [(ngModel)]="role" (ngModelChange)="selectRole()">
              <mat-option *ngFor="let item of all_roles | async" [value]="''+item['id']">{{ item["role_name"] }}</mat-option>
            </mat-select>
        </mat-form-field>
      </div>
       <div class="cm_fltr_sc mr_1">
        <span>Search</span>
        <mat-form-field appearance="outline" class="mr_1">
          <input matInput (keyup)="$event.keyCode == 13 ? applyFilters() : ''" [(ngModel)]="search_txt" placeholder="{{'search_text'|translate}}"/>
          <mat-icon matSuffix (click)="applyFilters()">search</mat-icon>
        </mat-form-field>
      </div>
    </div>
    <div class="d_flx_ac fw_w">
      <div class="cm_fltr_sc mr_1" *ngIf="is_university && role_specific">
        <span>{{"organization_type"|translate}}</span>
        <mat-form-field appearance="outline">
            <mat-select placeholder="{{'select_text'|translate}} {{'organization_type'|translate}}" name="organization_edit" #organization_edit="ngModel" [(ngModel)]="organization_type_id" (ngModelChange)="onOrganizationTypeChange()">
                <mat-option *ngFor="let item of organization_types" [value]="item.value">{{ item.viewValue }}</mat-option>
            </mat-select>
        </mat-form-field>
      </div>
      <div class="cm_fltr_sc mr_1" *ngIf="is_university && role_specific">
        <span>{{ organization_type_name ? organization_type_name : 'Organization List' }} </span>
          <mat-form-field appearance="outline">
              <mat-select placeholder="{{'select_text'|translate}} {{ organization_type_name }}" name="organization_list_edit" #organization_list_edit="ngModel" [(ngModel)]="organization_list_id" (ngModelChange)="getCollege(organization_type_id,0,'year')">
                  <mat-option>
                      <ngx-mat-select-search [noEntriesFoundLabel]="'No Record Found'" [placeholderLabel]="'Search'" name="search_university" ngModel (ngModelChange)="filterPartners($event)" >
                      </ngx-mat-select-search>
                  </mat-option>
                  <mat-option *ngFor="let item of all_organization_list | async" [value]="item['pk_id']">{{ item["organization_name"] }}</mat-option>
              </mat-select>
          </mat-form-field>
      </div>
      <div class="cm_fltr_sc mr_1" *ngIf="is_college && role_specific">
          <span>{{"college"|translate}}</span>
          <mat-form-field appearance="outline">
              <mat-select placeholder="{{'select_text'|translate}} {{'college'|translate}}" name="college_edit" #college_edit="ngModel" [(ngModel)]="college_id" (ngModelChange)="getYearSemsterGroup(organization_type_id,0,'year')">
                  <mat-option>
                      <ngx-mat-select-search [noEntriesFoundLabel]="'No Record Found'"
                          [placeholderLabel]="'Search'" name="search_university" ngModel (ngModelChange)="filterCollege($event)"
                          >
                      </ngx-mat-select-search>
                  </mat-option>
                  <mat-option *ngFor="let item of all_college | async" [value]="item['pk_id']">{{ item["partner_name"] }}</mat-option>
              </mat-select>
          </mat-form-field>
      </div>
      <div class="cm_fltr_sc mr_1" *ngIf="role_specific && ysg">
          <span>{{"year"|translate}}</span>
          <mat-form-field appearance="outline">
              <mat-select placeholder="{{'select_text'|translate}} {{'year'|translate}}" name="year_edit" #year_edit="ngModel" [(ngModel)]="year_id" (ngModelChange)="getYearSemsterGroup(organization_type_id,year_id,'semester')">
                  <mat-option *ngFor="let item of all_years | async" [value]="item['pk_id']">{{ item["name"] }}</mat-option>
              </mat-select>
          </mat-form-field>
      </div>
      <div class="cm_fltr_sc mr_1" *ngIf="show_semester_dropdown && role_specific && ysg">
          <span>{{"semester"|translate}}</span>
          <mat-form-field appearance="outline">
              <mat-select placeholder="{{'select_text'|translate}} {{'semester'|translate}}" name="semester_edit" #semester_edit="ngModel" [(ngModel)]="semester_id" (ngModelChange)="getYearSemsterGroup(organization_type_id,semester_id,'group')" >
                  <mat-option *ngFor="let item of all_semesters | async" [value]="item['pk_id']">{{ item["name"] }}</mat-option>
              </mat-select>
          </mat-form-field>
      </div>
      <div class="cm_fltr_sc mr_1" *ngIf="show_group_dropdown && role_specific && ysg">
          <span>{{"group"|translate}}</span>
          <mat-form-field appearance="outline">
              <mat-select placeholder="{{'select_text'|translate}} {{'group'|translate}}" name="group_edit" #group_edit="ngModel" [(ngModel)]="group_id" (ngModelChange)="doFilter()">
                  <mat-option *ngFor="let item of all_groups | async" [value]="item['pk_id']">{{ item["name"] }}</mat-option>
              </mat-select>
          </mat-form-field>
      </div>
      <div class="cm_fltr_sc mr_1">
        <div class="crt_prt_hd">Date Range</div>
        <mat-form-field appearance="outline">
          <mat-date-range-input [rangePicker]="picker">
            <input matStartDate  [max]="maxDate" [(ngModel)]="from_date" (dateChange)="fromdateChabge()" readonly placeholder="{{'admin.lgn_his.from_date'|translate}}">
            <input matEndDate  [min]="tomindate" [max]="maxDate" [(ngModel)]="to_date" (dateChange)="todateChabge()" [disabled]="is_todate" readonly placeholder="{{'admin.lgn_his.to_date'|translate}}">
          </mat-date-range-input>
          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-date-range-picker #picker></mat-date-range-picker>
        </mat-form-field>
      </div>     
      <div class="cm_fltr_sc mr_1">
          <div class="crt_prt_hd">&nbsp;</div>
        <button mat-raised-button color="accent" class="float_right mr_1 btn_st_frm" (click)="applyFilters()" [disabled]="is_submit">{{"submit"|translate}}</button>
      </div>
      <div class="cm_fltr_sc mr_1">
        <div class="crt_prt_hd">&nbsp;</div>
        <button mat-raised-button color="warn" class="float_right mr_1 btn_st_frm" (click)="resetFilters()" matTooltip="{{'admin.lgn_his.reset'|translate}}"><mat-icon>restart_alt</mat-icon></button>
      </div>
      <div class="cm_fltr_sc mr_1">
        <div class="crt_prt_hd">&nbsp;</div>
        <span class="download_icons">
          <a
          href="{{ api_url }}export-login-history/PDF/{{
            search_txt ? search_txt : 0
          }}/{{ fromDate ? fromDate : 0 }}/{{ toDate ? toDate : 0 }}/{{user_id}}/{{role?role:0}}/{{organization_list_id?organization_list_id:0}}/{{college_id?college_id:0}}/{{year_id?year_id:0}}/{{semester_id?semester_id:0}}/{{group_id?group_id:0}}"
          mat-icon-button
          color="accent"
          class="float_right "
          type="button"
          matTooltip="{{'admin.lgn_his.download_pdf'|translate}}"
          matTooltipPosition="above"
          ><mat-icon>picture_as_pdf</mat-icon></a>
          <a
          href="{{ api_url }}export-login-history/EXL/{{
            search_txt ? search_txt : 0
          }}/{{ fromDate ? fromDate : 0 }}/{{ toDate ? toDate : 0 }}/{{user_id}}/{{role?role:0}}/{{organization_list_id?organization_list_id:0}}/{{college_id?college_id:0}}/{{year_id?year_id:0}}/{{semester_id?semester_id:0}}/{{group_id?group_id:0}}"
          mat-icon-button
          color="accent"
          class="float_right mr_1"
          type="button"
          ><mat-icon matTooltip="{{'admin.lgn_his.download_excel'|translate}}" matTooltipPosition="above">description</mat-icon></a>
        </span>
      </div>  
    </div>
    <div class="rsp_tbl">
      <table mat-table (matSortChange)="sortData($event)" class="mat-elevation-z8" [dataSource]="dataSource" matSort>
        <ng-container matColumnDef="pk_id">
          <th mat-header-cell *matHeaderCellDef mat-sort-header class="s_no">{{"s_no_text"|translate}}</th>
          <td mat-cell *matCellDef="let element" class="s_no">{{ element.s_no }}</td>
        </ng-container>
        <ng-container matColumnDef="first_name">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>{{"admin.lgn_his.name"|translate}}</th>
          <td mat-cell *matCellDef="let element">{{ element.name }}</td>
        </ng-container>
        <ng-container matColumnDef="email">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>{{"admin.lgn_his.email"|translate}}</th>
          <td mat-cell *matCellDef="let element">{{ element.email ? element.email : "-" }}</td>
        </ng-container>
        <ng-container matColumnDef="latitude">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>{{"admin.lgn_his.latitude"|translate}}</th>
          <td mat-cell *matCellDef="let element">{{ element.latitude }}</td>
        </ng-container>
        <ng-container matColumnDef="longitude">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>{{"admin.lgn_his.longitude"|translate}}</th>
          <td mat-cell *matCellDef="let element">{{ element.longitude }}</td>
        </ng-container>
        <ng-container matColumnDef="country_name">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>{{"admin.lgn_his.country"|translate}}</th>
          <td mat-cell *matCellDef="let element">{{ element.country_name }}</td>
        </ng-container>
        <ng-container matColumnDef="city_name">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>{{"admin.lgn_his.city"|translate}}</th>
          <td mat-cell *matCellDef="let element">{{ element.city_name }}</td>
        </ng-container>
        <ng-container matColumnDef="platform_name">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>{{"admin.lgn_his.platform_name"|translate}}</th>
          <td mat-cell *matCellDef="let element">{{ element.platform_name }}</td>
        </ng-container>
        <ng-container matColumnDef="device_type">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>{{"admin.lgn_his.device_type"|translate}}</th>
          <td mat-cell *matCellDef="let element">{{ element.device_type }}</td>
        </ng-container>
        <ng-container matColumnDef="browser">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>{{"admin.lgn_his.browser"|translate}}</th>
          <td mat-cell *matCellDef="let element">{{ element.browser }}</td>
        </ng-container>
        <ng-container matColumnDef="ip_v4_address">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>{{"admin.lgn_his.ip_address"|translate}}</th>
          <td mat-cell *matCellDef="let element">{{ element.ip_v4_address }}</td>
        </ng-container>
        <ng-container matColumnDef="login_time">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>{{"admin.lgn_his.login_time"|translate}}</th>
          <td mat-cell *matCellDef="let element">{{ element.login_time }}</td>
        </ng-container>
        <ng-container matColumnDef="logout_time">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>{{"admin.lgn_his.logout_time"|translate}}</th>
          <td mat-cell *matCellDef="let element">{{ element.logout_time }}</td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        <tr class="mat-row no_rcrds_fd" *matNoDataRow>
          <td class="mat-cell" [attr.colspan]="displayedColumns.length">{{"no_records_found_text"|translate}}</td>
        </tr>
      </table>
    </div>
    <mat-paginator
      #paginator
      [pageSize]="pageSize"
      [length]="num_rows"
      [pageSizeOptions]="page_size_options"
      [showFirstLastButtons]="true"
      (page)="getServerData($event)"
    ></mat-paginator>
  </div>
</div>

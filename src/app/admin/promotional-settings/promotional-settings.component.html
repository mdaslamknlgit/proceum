<div class="mn_dshbrd">
  <div class="brd_crm">
    Proceum &raquo; <strong>Promotional Settings</strong>
  </div>
  <div class="d-flex">
    <div class="pg_ttl">Promotional Settings</div>
    <div class="spacer"></div>
    <div>
      <button mat-raised-button color="accent" (click)="toggleModel()" type="button">
        <mat-icon>add</mat-icon> New Promotional
      </button>
    </div>
  </div>
  <hr>
  <div class="hgt_10"></div>
  <div class="cust_mdl_par cust_mdl_50p" [ngClass]="{ cust_mdl_opn: model_status }">
    <div class="cust_mdl_chl">
      <div class="pg_ttl">
        Promotional Create
        <span class="spacer"></span>
        <button type="button" mat-icon-button (click)="toggleModel()">
          &#x2715;
        </button>
      </div>
      <form id="promotional_form" #promotional_form="ngForm" name="promotional_form"
        (ngSubmit)="promotional_form.valid && createPromotional()" novalidate>
        <div class="tbbd_bdy">
          <div class="grd_2c no_bxsdw">
            <span class="text-right w_100p rqrd_txtinfo">
              All <span class="required">( * ) </span>marked fields are
              mandatory</span>
            <div class="hgt_20"></div>
            <div class="frm_dvs">
              <span>Promo/Coupon Code <span class="required">*</span></span>
              <span>
                <span class="err_tltp_par">
                  <mat-form-field appearance="outline">
                    <input required maxlength="15" pattern="[A-Za-z0-9]*" name="code_name" [(ngModel)]="code" matInput
                      placeholder="Promo/Coupon Code" #code_name="ngModel" (blur)="generateCoupon()" />
                  </mat-form-field>
                  <span class="prc_tltp" *ngIf="
                      (promotional_form.submitted || code_name.touched) &&
                      code_name.invalid
                    ">Promo/Coupon Code is required and allowed Alphanumeric only
                  </span>
                </span>
                <button (click)="generateCoupon()" mat-raised-button color="accent" class="ml_1 margin-bottom_20"
                  type="button">
                  Generate
                </button>
              </span>
            </div>
            <div class="frm_dvs">
              <span class="algn_s_fs">Description <span class="required">*</span></span>
              <span>
                <span class="err_tltp_par">
                  <mat-form-field appearance="outline">
                    <textarea required name="description_name" [(ngModel)]="description" matInput
                      placeholder="Description" #description_name="ngModel"
                      (blur)="description = description.trim()"></textarea>
                  </mat-form-field>
                  <span class="prc_tltp" *ngIf="
                      (promotional_form.submitted ||
                        description_name.touched) &&
                      description_name.invalid
                    ">Description is required</span>
                </span></span>
            </div>
            <div class="frm_dvs w_100p">
              Set Discount Amounts Country Wise
            </div>
            <div class="hgt_10"></div>
            <div class="frm_dvs slct_dsc_amnt">
              <div class="w_30p mr_1p">
                  Country
              </div>
              <div class="w_30p mr_1p">
                  Discount Amount
              </div>
              <div class="w_30p mr_1p">
                  Min. Order Amount
              </div>
              <div class="w_7p">
                  &nbsp;
              </div>
            </div>
            <div class="frm_dvs slct_dsc_amnt">
              <div *ngFor="let price of discount_amounts;let i = index" class="w_100p">
                <div class="w_100p" *ngIf="price['status'] != '0'">
                  <div class="w_30p mr_1p">
                    <mat-form-field appearance="outline" class="mt_05">
                      <mat-select placeholder="Select Country" [(ngModel)]="discount_amounts[i]['country_id']"
                        name="discount_amount_country_{{i}}" required>
                        <mat-option value="">Select Country</mat-option>
                        <ng-container *ngFor="let country of all_countries | async">
                          <mat-option [disabled]="selected_countires.indexOf(country['id']) !== -1"
                            [value]="country['id']"
                            (click)=" addCurrencyToField(country['currency_text'],i,country['id']);">
                            {{ country['country_name'] }}
                          </mat-option>
                        </ng-container>
                      </mat-select>
                    </mat-form-field>
                  </div>
                  <div class="w_30p mr_1p">
                      <mat-form-field appearance="outline" class="mt_05">
                        <input [(ngModel)]="discount_amounts[i]['discount_amount']" name="discount_amounts_{{i}}"
                          matInput placeholder="{{ discount_amounts[i]['placeholder'] }}" maxlength="7" appNumbersonly
                          required [disabled]="discount_amounts[i]['country_id'] == ''" />
                        <span matPrefix></span>
                      </mat-form-field>
                  </div>
                  <div class="w_30p mr_1p">
                      <mat-form-field appearance="outline" class="mt_05">
                        <input [(ngModel)]="discount_amounts[i]['min_order_amount']" name="min_order_amount{{i}}"
                          matInput placeholder="Min order amount" maxlength="7" appNumbersonly required
                          [disabled]="discount_amounts[i]['country_id'] == ''" />
                        <span matPrefix></span>
                      </mat-form-field>
                  </div>
                  <div class="mt_6px w_7p">
                    <button type="button" (click)="removeDiscountAmountField(i)" mat-icon-button class="no_bxsdw"
                      color="warn" *ngIf="i > 0">
                      <mat-icon>remove_circle_outline</mat-icon>
                    </button>
                  </div>
                </div>
              </div>
              <div class="text_right w_100p">
                <button mat-raised-button color="accent" type="button" (click)="addDiscountAmountField()">
                  <mat-icon>add</mat-icon> Add More
                </button>
              </div>
            </div>

            <div class="frm_dvs">
              <span>Valid From Date <span class="required">*</span></span>
              <span>
                <span class="err_tltp_par">
                  <mat-form-field appearance="outline" class="cal_wdth" color="accent">
                    <input placeholder="Select From Date" required name="valid_from_name" #valid_from_name="ngModel"
                      [(ngModel)]="valid_from" matInput [matDatepicker]="picker" autocomplete="off"
                      [min]="today_date" />
                    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                    <mat-datepicker #picker></mat-datepicker>
                  </mat-form-field>
                  <span class="prc_tltp" *ngIf="
                      (promotional_form.submitted || valid_from_name.touched) &&
                      valid_from_name.invalid
                    ">From Date is required</span>
                </span>
              </span>
            </div>
            <div class="frm_dvs">
              <span>Valid To Date <span class="required">*</span></span>
              <span>
                <span class="err_tltp_par">
                  <mat-form-field appearance="outline" class="cal_wdth" color="accent">
                    <input placeholder="Select To Date" required name="valid_to_name" #valid_to_name="ngModel"
                      [(ngModel)]="valid_to" matInput [matDatepicker]="picker2" autocomplete="off" [min]="valid_from" />
                    <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
                    <mat-datepicker #picker2></mat-datepicker>
                  </mat-form-field>
                  <span class="prc_tltp" *ngIf="
                      (promotional_form.submitted || valid_to_name.touched) &&
                      valid_to_name.invalid
                    ">To Date is required</span>
                </span>
              </span>
            </div>
          </div>
        </div>
        <hr />
        <button mat-raised-button color="accent" class="float_right mr_1">
          Submit
        </button>
        <button mat-raised-button class="float_right mr_1 gry_btn" (click)="toggleModel()">
          Close
        </button>
      </form>
      <div class="hgt_20"></div>
    </div>
  </div>

  <div class="dsh_brd_crds">
    <mat-form-field appearance="outline">
      <input matInput [(ngModel)]="search_box" (keyup)="$event.keyCode == 13 ? doFilter() : ''" placeholder="Search" />
      <mat-icon (click)="doFilter()" matSuffix>search</mat-icon>
    </mat-form-field>


    <div class="rsp_tbl">
      <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8">
        <!-- Position Column -->
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef>S.No</th>
          <td mat-cell *matCellDef="let element">
            {{ element.s_no }}
          </td>
        </ng-container>

        <ng-container matColumnDef="code">
          <th mat-header-cell *matHeaderCellDef mat-sort-header cdkDrag>
            Promo/Coupon
          </th>
          <td mat-cell *matCellDef="let element">
            <span>{{ element.code }}</span>
          </td>
        </ng-container>
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef cdkDrag>Status</th>
          <td mat-cell *matCellDef="let element">

            <mat-slide-toggle (click)="deletePromotional(element.pk_id, element.status)"
              [checked]="element.status == 1 ? true : false"
              matTooltip="{{element.status == 1 ? 'Make Inactive' : 'Make Active'}}">
            </mat-slide-toggle>

            <!-- <span matTooltip="Current Status is {{
                element.status == 1 ? 'ACTIVE' : 'IN-ACTIVE'
              }}" class="{{ element.status == 1 ? 'sts_grn' : 'sts_rd' }}">{{ element.status == 1 ? "Active" :
              "Inactive" }}</span> -->

          </td>
        </ng-container>
        <ng-container matColumnDef="created_at">
          <th mat-header-cell *matHeaderCellDef cdkDrag>Valid From</th>
          <td mat-cell *matCellDef="let element">{{ element.valid_from }}</td>
        </ng-container>
        <!-- Symbol Column -->
        <ng-container matColumnDef="updated_at">
          <th mat-header-cell *matHeaderCellDef cdkDrag>Valid To</th>
          <td mat-cell *matCellDef="let element">{{ element.valid_to }}</td>
        </ng-container>
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let element">
            <button mat-icon-button (click)="editPromotional(element)" color="accent" matTooltip="Click to edit">
              <mat-icon>edit-notes</mat-icon>
            </button>
            <!-- <button matTooltip="click here to {{
                element.status == 1 ? 'IN-ACTIVE' : 'ACTIVE'
              }}" mat-icon-button mwlConfirmationPopover [popoverTitle]="'Are you sure?'" [popoverMessage]="
                'Are you sure to change status of <b>' +
                element.code +
                '</b> Promotional'
              " placement="auto" (confirm)="deletePromotional(element.pk_id, element.status)"
              confirmButtonType="danger" cancelButtonType="outline-secondary">
              <mat-icon *ngIf="element.status == 1">visibility_off</mat-icon>
              <mat-icon *ngIf="element.status == 0">visibility</mat-icon>
            </button> -->
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        <tr class="mat-row no_rcrds_fd" *matNoDataRow>
          <td class="mat-cell" [attr.colspan]="displayedColumns.length">No Records Found</td>
        </tr>
      </table>
    </div>
    <mat-paginator [pageSizeOptions]="page_size_options" showFirstLastButtons (page)="getServerData($event)">
    </mat-paginator>
  </div>
</div>
<div class="cust_mdl_par cust_mdl_50p" [ngClass]="{ cust_mdl_opn: edit_model_status }">
  <div class="cust_mdl_chl">
    <div class="pg_ttl">
      Promotional Edit
      <span class="spacer"></span>
      <button type="button" mat-icon-button (click)="edit_model_status = !edit_model_status">
        &#x2715;
      </button>
    </div>
    <div class="tbbd_bdy">
      <form id="edit_promotional_form" #edit_promotional_form="ngForm" name="edit_promotional_form"
        (ngSubmit)="edit_promotional_form.valid && updatePromotional()" novalidate>
        <div class="tbbd_bdy">
          <div class="grd_2c no_bxsdw">
            <span class="text-right w_100p rqrd_txtinfo">
              All <span class="required">( * ) </span>marked fields are
              mandatory</span>
            <div class="hgt_20"></div>
            <div class="frm_dvs">
              <span>Promo/Coupon Code <span class="required">*</span></span>
              <span>
                <span class="err_tltp_par">
                  <mat-form-field appearance="outline">
                    <input required maxlength="15" pattern="[A-Za-z0-9]*" name="code_name_edit" [(ngModel)]="code"
                      matInput placeholder="Promo/Coupon" #code_name_edit="ngModel" />
                  </mat-form-field>

                  <span class="prc_tltp" *ngIf="
                      (edit_promotional_form.submitted ||
                        code_name_edit.touched) &&
                      code_name_edit.invalid
                    ">Promo/Copoun is required and allowed Alphanumeric
                    only</span>
                </span>
              </span>
            </div>

            <div class="frm_dvs">
              <span class="algn_s_fs">Description <span class="required">*</span></span>
              <span>
                <span class="err_tltp_par">
                  <mat-form-field appearance="outline">
                    <textarea required name="description_name_edit" [(ngModel)]="description" matInput
                      placeholder="Description" #description_name_edit="ngModel"
                      (blur)="description = description.trim()"></textarea>
                  </mat-form-field>
                  <span class="prc_tltp" *ngIf="
                      (edit_promotional_form.submitted ||
                        description_name_edit.touched) &&
                      description_name_edit.invalid
                    ">Description is required</span>
                </span></span>
            </div>
            <div class="frm_dvs">
              <div>Set Discount Amounts Country Wise</div>
            </div>
            <div class="hgt_10"></div>
            <div class="frm_dvs slct_dsc_amnt">
              <div class="w_30p mr_1p">
                  Country
              </div>
              <div class="w_30p mr_1p">
                  Discount Amount
              </div>
              <div class="w_30p mr_1p">
                  Min. Order Amount
              </div>
              <div class="w_7p">
                  &nbsp;
              </div>
            </div>
            <div class="frm_dvs slct_dsc_amnt">
               <div *ngFor="let price of discount_amounts;let i = index" class="w_100p">
                <div class="w_100p" *ngIf="price['status'] != '0'">
                  <div class="w_30p mr_1p">
                    <div class="err_tltp_par">
                      <mat-form-field appearance="outline" class="mt_05">
                        <mat-select placeholder="Select Country" [(ngModel)]="discount_amounts[i]['country_id']"
                          name="discount_amount_country_{{i}}" required>
                          <mat-option value="">Select Country</mat-option>
                          <ng-container *ngFor="let country of all_countries | async">
                            <mat-option [disabled]="selected_countires.indexOf(country['id']) !== -1"
                              [value]="country['id']"
                              (click)=" addCurrencyToField(country['currency_text'],i,country['id']);">
                              {{ country['country_name'] }}
                            </mat-option>
                          </ng-container>
                        </mat-select>
                      </mat-form-field>
                    </div>
                  </div>
                  <div class="w_30p mr_1p">
                    <div class="err_tltp_par">
                      <mat-form-field appearance="outline" class="mt_05">
                        <input [(ngModel)]="discount_amounts[i]['discount_amount']" name="discount_amounts_{{i}}"
                          matInput placeholder="{{ discount_amounts[i]['placeholder'] }}" maxlength="7" appNumbersonly
                          required [disabled]="discount_amounts[i]['country_id'] == ''" />
                        <span matPrefix></span>
                      </mat-form-field>
                    </div>
                  </div>
                  <div class="w_30p mr_1p">
                    <div class="err_tltp_par">
                      <mat-form-field appearance="outline" class="mt_05">
                        <input [(ngModel)]="discount_amounts[i]['min_order_amount']" name="min_order_amount_{{i}}"
                          matInput placeholder="Min order amount" maxlength="7" appNumbersonly required
                          [disabled]="discount_amounts[i]['country_id'] == ''" />
                        <span matPrefix></span>
                      </mat-form-field>
                    </div>
                  </div>
                  <div class="mt_6px w_7p">
                    <button type="button" (click)="removeDiscountAmountField(i)" mat-icon-button class="no_bxsdw"
                      color="warn" *ngIf="i > 0">
                      <mat-icon>remove_circle_outline</mat-icon>
                    </button>
                  </div>

                </div>
              </div>

              <div class="text_right w_100p">
                <button mat-raised-button color="accent" type="button" (click)="addDiscountAmountField()">
                  <mat-icon>add</mat-icon> Add More
                </button>
              </div>
            </div>


            <div class="frm_dvs">
              <span>Valid From Date <span class="required">*</span></span>
              <span>
                <span class="err_tltp_par">
                  <mat-form-field appearance="outline" class="cal_wdth" color="accent">
                    <input placeholder="Select From Date" required name="valid_from_name_edit"
                      #valid_from_name_edit="ngModel" [(ngModel)]="valid_from" matInput [matDatepicker]="picker3"
                      autocomplete="off" [min]="today_date" />
                    <mat-datepicker-toggle matSuffix [for]="picker3"></mat-datepicker-toggle>
                    <mat-datepicker #picker3></mat-datepicker>
                  </mat-form-field>
                  <span class="prc_tltp" *ngIf="
                      (edit_promotional_form.submitted ||
                        valid_from_name_edit.touched) &&
                      valid_from_name_edit.invalid
                    ">From Date is required</span>
                </span>
              </span>
            </div>
            <div class="frm_dvs">
              <span>Valid To Date <span class="required">*</span></span>
              <span>
                <span class="err_tltp_par">
                  <mat-form-field appearance="outline" class="cal_wdth" color="accent">
                    <input placeholder="Select To Date" required name="valid_to_name_edit" #valid_to_name_edit="ngModel"
                      [(ngModel)]="valid_to" matInput [matDatepicker]="picker4" autocomplete="off" [min]="valid_from" />
                    <mat-datepicker-toggle matSuffix [for]="picker4"></mat-datepicker-toggle>
                    <mat-datepicker #picker4></mat-datepicker>
                  </mat-form-field>
                  <span class="prc_tltp" *ngIf="
                      (edit_promotional_form.submitted ||
                        valid_to_name_edit.touched) &&
                      valid_to_name_edit.invalid
                    ">To Date is required</span>
                </span>
              </span>
            </div>
          </div>
        </div>
        <hr />
        <button mat-raised-button color="accent" class="float_right mr_1">
          Submit
        </button>
        <button mat-raised-button class="float_right mr_1 gry_btn" (click)="edit_model_status = !edit_model_status">
          Close
        </button>
      </form>
      <div class="hgt_20"></div>
    </div>
  </div>
</div>